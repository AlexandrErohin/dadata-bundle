language: php

php:
  - '7.2'
  - '7.3'
  - '7.4'

env:
  - SYMFONY_VERSION=4.4.*
  - SYMFONY_VERSION=5.0.*
  - SYMFONY_VERSION=5.1.*

cache:
  directories:
    - ~/.composer/cache/files

before_install:
  - phpenv config-rm xdebug.ini || true

install:
  - composer require symfony/config:${SYMFONY_VERSION} --no-update --no-scripts --prefer-dist
  - composer require symfony/dependency-injection:${SYMFONY_VERSION} --no-update --no-scripts --prefer-dist
  - composer require symfony/http-client:${SYMFONY_VERSION} --no-update --no-scripts --prefer-dist
  - composer require symfony/http-kernel:${SYMFONY_VERSION} --no-update --no-scripts --prefer-dist

  - composer require --dev symfony/phpunit-bridge:${SYMFONY_VERSION} --no-update --no-scripts --prefer-dist
  - composer require --dev symfony/yaml:${SYMFONY_VERSION} --no-update --no-scripts --prefer-dist

  - composer update --prefer-dist

script:
  - composer check
  - composer validate --strict --no-check-lock
  - vendor/bin/php-cs-fixer fix -v --dry-run
  - vendor/bin/phpstan analyse
  - vendor/bin/simple-phpunit $PHPUNIT_FLAGS